<div id="app1">
    <form   @submit.prevent="updateUser">
        <div v-if="success" class='bg-success p-2' >
            [[success]]
        </div>
        <div classs="form-group row">
            <div class="col-12">
                <label for="exampleInputName">Nazwa użytkownika</label>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-9">
                <input type="text" name='username'  v-model="form.username" class="form-control" id="exampleInputName" >
                <div  v-if="error" class="text-danger">
                    [[error]]
                </div>
            </div>
            <div class="col-2">
                <button class="btn btn-primary" type="submit"> Zmień</button>
            </div>
        </div>
    </form>
</div>

{% block script %}
<script>
    function sendRequest(url,method,data){
        let r  = axios({
            method: method,
            url: url,
            data: data,
            headers: {
                'X-CSRFToken' : '{{csrf_token}}',
                'Content-Type' : 'application/json'
            }
        })
        return r;
    }

    var app = new Vue({
        el: '#app1',
        delimiters: ['[[', ']]'],
        data() {
            return{
                form:{
                    username: '{{request.user.username}}',
                },
                error: "",
                success:"",
            }
        },
        methods: {
            updateUser(){
                console.log('submit');
                sendRequest("{% url 'user_update' %}",'POST',this.form)
                .then(response =>{
                    this.success = response.data['success'];
                    this.error = '';
                })
                .catch( err =>{
                    this.error = err.response.data['error'];
                    this.success = '';
                })               
            },
        }
    })

</script>

{% endblock  %}