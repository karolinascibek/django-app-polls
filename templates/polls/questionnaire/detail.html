{% extends 'polls/base.html' %}
{% load humanize %}

{% block polls %}
<div id='app-questionnaire'>
<div class="row justify-content-center my-4">
    <div class="col-lg-8 col-md-10 col-xs-12 pr-4">
        <div>
            <!-- delete update button-->
            <div class="text-right d-flex justify-content-end">
                <a href="{% url 'update_questionnaire' id=questionnaire.id %}" class="btn p-0 m-0 ">
                    <i class="fas fa-edit bg-secondary text-white rounded p-3"></i>
                </a>
                <form action="{% url 'delete_questionnaire' id=questionnaire.id %}" method="POST" ref='form' v-on:submit.prevent='deleteQuestionnaire'>
                    {% csrf_token %}
                    <button class="btn p-0 m-0 ">
                        <i class="fas fa-times p-3 text-white bg-danger rounded"></i>
                    </button>
                </form>
            </div>
        </div>
        <div class="">
            <h3>{{questionnaire.name}}</h3>
            <p> {{questionnaire.created_at|date:"D d/m/Y"}}</p>
        </div>
    </div>
</div>
<div class="row justify-content-center mb-2">
    {% if not questionnaire.status %}
    <div class="col-lg-8 col-md-10 col-xs-12">
        <a class="btn btn-primary" href="{% url 'create_question' id=questionnaire.id %}">Dodaj pytanie</a>
    </div>
    {% endif %}
</div>
<div class="row justify-content-center">
    <div class="col-lg-8 col-md-10 col-xs-12">
        <div class="row justify-content-center">
            <div class="col-12 ">
                {% for question in questions %}
                <div class='bg-white rounded shadow p-2 mb-1'>
                    <!-- delete update button-->
                    {% if not questionnaire.status %}
                    <div class="text-right">
                        <a href="{% url 'update_question' id_question=question.id %}" class="btn p-0 m-0 ">
                            <i class="fas fa-edit text-success border rounded p-2"></i>
                        </a>
                        <a href="{% url 'delete_question' id_question=question.id %}" class="btn p-0 m-0 ">
                            <i class="fas fa-times p-2 text-danger border rounded" ></i>
                        </a>
                    </div>
                    {% endif %}
                    <!--display question and its choices if are closed questions-->
                    <div class="px-3 py-2">
                        <div class="">
                            <h4>{{question.contents}}</h4>
                        </div>
                        <ul>
                            {% for choice in question.choice_set.all %}                         
                                {% if question.type == 'single-choice' %}
                                <div class="custom-control custom-radio">
                                    <input type="radio" id="customRadio-{{choice.id}}" name="customRadio" class="custom-control-input">
                                    <label class="custom-control-label" for="customRadio-{{choice.id}}">{{choice.contents}}</label>
                                  </div>
                                {% elif question.type == 'multiple-choice' %}
                                <div class="custom-control custom-checkbox checkbox-dark">
                                    <input type="checkbox" class="custom-control-input " id="customCheck-{{choice.id}}">
                                    <label class="custom-control-label" for="customCheck-{{choice.id}}">{{choice.contents}}</label>
                                  </div>
                                {% endif %}
                            {% endfor %}
                            {% if question.type == 'number' %}
                            <div class="form-group">
                                <input type="number" class="form-control"  placeholder="Wpisz liczbe">
                            </div>
                            {% elif question.type == 'text' %}
                                <div class="form-group">
                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                </div>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
</div>

{% block script %}
<script>
    var appDelete = new Vue({
        el: '#app-questionnaire',
        delimiters:['[[',']]'],
        data(){
            return{
                isYes:false,
            }
        },
        methods: {
            deleteQuestionnaire:function(e){
                this.isYes = confirm("Czy na pewno chcesz usunąć ankiete?")
                console.log(this.isYes)
                if( this.isYes ){
                    this.$refs.form.submit()
                }
                
            }
        },
    })
</script>
{% endblock %}
{% endblock %}